---
title: âš› React.Suspenseë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë™ê¸° Pending ê´€ë¦¬í•˜ê¸°
date: 2021-07-07 15:48:00
category: 'Study'
draft: false
tag: 'Think'
---

ì´ì „ì— `React-Query`ë¥¼ ì‚¬ìš©í•˜ì—¬, ë¹„ë™ê¸° ì‘ì—…ì„ í†µí•´ ì–»ì€ ë°ì´í„°ë¥¼ ìºì‹±í•˜ê³ , ì§€ì •í•œ ì‹œê°„ì— ë”°ë¼ ìµœì‹  ì—¬ë¶€ë¥¼ íŒŒì•…í•˜ê³  ì—…ë°ì´íŠ¸í•˜ì—¬ ì‚¬ìš©ìì—ê²Œ ì¢‹ì€ ìœ ì €ê²½í—˜ì„ ì¤„ ìˆ˜ ìˆë„ë¡ í”„ë¡œê·¸ë˜ë°ì„ í•˜ì˜€ë‹¤.

ì´ë²ˆì—ëŠ” ë¹„ë™ê¸°ì‘ì—…ì— ë§ˆì°¬ê°€ì§€ë¡œ ìì£¼ ì‚¬ìš©í•´ì™”ë˜ `isLoading`ê³¼ ê°™ì€ `Pending`ìƒíƒœì¼ ë•Œì˜ ê´€ë¦¬ë¥¼ í•´ë³´ë ¤ê³  í•œë‹¤.

## ğŸœ React Suspense

ì´ì „ì— `React-Query`ì˜ `suspense` ì†ì„±ì„ í†µí•´ ë°ì´í„°ê°€ ë°›ì•„ì§€ì§€ ì•Šì•˜ë‹¤ë©´ ì´í›„ ë Œë”ë§ì„ ì¤‘ì§€ì‹œì¼œì£¼ê¸° ê¹Œì§€ëŠ” ì„±ê³µí•˜ì˜€ë‹¤. í•˜ì§€ë§Œ, ê·¸ ì¤‘ì§€ìƒíƒœì¼ ë•Œì˜ ë Œë”ë§ì— ëŒ€í•´ì„œëŠ” í•´ê²°í•˜ì§€ ëª»í–ˆì—ˆë‹¤.

`React`ì—ì„œëŠ” `Suspense`ë¼ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ”ë°, í•´ë‹¹ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ `ê¸°ë‹¤ë¦¬ê¸°` ë¼ëŠ” í‚¤ì›Œë“œë¥¼ ê°–ê³ ìˆëŠ” ìƒí™©ì— ì‚¬ìš©ì„ í•  ìˆ˜ ìˆë‹¤.

ëŒ€í‘œì ìœ¼ë¡œ, ë¹„ë™ê¸°ì‘ì—…ì„ ì§„í–‰í•˜ë©´ì„œ ë°œìƒí•˜ëŠ” ë¡œë”©ì‹œê°„ì„ **ê¸°ë‹¤ë¦¬ë©´ì„œ** ì²˜ë¦¬í•  ì‘ì—…ë“¤ì„ ëŒ€ì²´í•˜ëŠ” ê²ƒì´ë‹¤.

### ğŸ¥˜ useStateë¥¼ í†µí•œ loading

ì´ì „ê¹Œì§€ëŠ” ëŠ˜ ì´ë ‡ê²Œ ë¹„ë™ê¸° ì‘ì—…ì„ ìˆ˜í–‰í•˜ê¸° ì´ì „ì— `loading`ì´ë¼ëŠ” ìƒíƒœê°’ì„ ë³€ê²½í•˜ì—¬ `UI`ë¥¼ ë„ì›Œì™”ì—ˆë‹¤

```js
const fetchData = useCallback(async () => {
  try {
    setLoading(true)
    const data = await callback()
    setState(data)
  } catch (error) {
    throw new Error(err)
    setLoading(false)
  }
}, [setLoading, callback, setState])
```

### ğŸ² React.Suspenseë¥¼ í†µí•œ loading

ë¹„ë™ê¸°ë¡œ ì‘ì—…ë˜ëŠ” ì»´í¬ë„ŒíŠ¸ë¥¼ `Suspense`ë¡œ ê°ì‹¸ê³ , ë¡œë”© ë•Œ ë³´ì—¬ì¤„ í™”ë©´ì„ `fallback` ì†ì„±ìœ¼ë¡œ ì „ë‹¬í•œë‹¤.

ë¡œë”©í™”ë©´ì„ ìƒì„±í•˜ê¸° ìœ„í•œ `useState`ì™€ ê°™ì€ `hook`ë“¤ì´ ìƒì„±ë  í•„ìš”ê°€ ì—†ì–´ì¡Œë‹¤.

```js
<Suspense fallback={<LoadingSpinner />}>
  <Event />
</Suspense>
```

## ğŸ£ React-Query + Suspense

```js
export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      retry: false,
      suspense: true,
    },
  },
})
```

`suspense`ì˜µì…˜ì´ í™œì„±í™” ëœ `query`ëŠ” ë¹„ë™ê¸° ì‘ì—…ì—ì„œ `pending`ìƒíƒœì¼ ê²½ìš° `React Suspense`ì— ë³´ë‚´ì§„ `fallback` ì»´í¬ë„ŒíŠ¸ë¥¼ í™”ë©´ì— ë„ìš°ê²Œëœë‹¤.

### ğŸ± ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ

`Suspense`ë¡œ `suspense : true` ìƒíƒœì¸ `useQuery`ë¥¼ í¬í•¨í•œ ì»´í¬ë„ŒíŠ¸ë¥¼ ê°ì‹¸ì£¼ê³ , `fallback`ì†ì„±ìœ¼ë¡œ `pending`ë™ì•ˆ ë³´ì—¬ì§ˆ ì»´í¬ë„ŒíŠ¸ë¥¼ ë³´ë‚´ì¤€ë‹¤.

```js
<Suspense fallback={<LoadingSpinner />}>
  <Event />
</Suspense>
```

`Event`ì»´í¬ë„ŒíŠ¸ëŠ” `useQuery`ë¥¼ í†µí•´ ì´ë²¤íŠ¸ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ê²Œë˜ëŠ”ë°, `query`ì˜ íŠ¹ì„±ìƒ ë°ì´í„°ê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš°ë§Œì„ ê³ ë ¤í•˜ê¸° ë•Œë¬¸ì— ë°ì´í„°ê°€ ë°›ì•„ì§€ê¸° ì „ ê¹Œì§€ëŠ” ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸ ë˜ì§€ ì•ŠëŠ”ë‹¤.

ì¦‰, ì—¬ê¸°ì„œ ë¹„ë™ê¸°ì‘ì—…ì´ `pending`ìƒíƒœì¼ ë•Œ, `React-Query`ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ë‹¤ë©´, `data`ê°€ ì¡´ì¬í•˜ì§€ ì•Šë‹¤ëŠ” ì—ëŸ¬ê°€ ëœ¨ê±°ë‚˜ ë¡œë”©ì—¬ë¶€ë¥¼ íŒŒì•…í•  ìˆ˜ ì—†ëŠ” ë¹„ì–´ìˆëŠ” í™”ë©´ì´ ë–´ì—ˆì„ ê²ƒì´ë‹¤.

ì–´ë–»ê²Œ ë‹¬ë¼ì§€ëŠ”ì§€ í™•ì¸í•´ë³´ì

```js
const Event = () => {
  const eventData = useQuery('fetchEventData', () => API.getEventData(), {
    // í™”ë©´ì´ í¬ì»¤ì‹±ë  ë•Œ ë°ì´í„°ë¥¼ ìë™ìœ¼ë¡œ ë°›ëŠ”ê¸°ëŠ¥ì€ false
    // ê°œì¸ ì·¨í–¥..
    refetchOnWindowFocus: false,
  })

  return (
    <Styled.Content type="event">
      {eventData.events.map((event, index) => (
        <Styled.Event key={`event${index}`}>
          <Event event={event} />
        </Styled.Event>
      ))}
    </Styled.Content>
  )
}
```

<div style="text-align : center">
  <img src="/img/2021/07/07/2.gif?raw=true" alt="2">
</div>

ë°ì´í„°ê°€ `fetching`ì¤‘ì¼ ë•Œì—ëŠ”, `Suspense`ë¡œ ë³´ë‚´ì§„ `fallback` ì»´í¬ë„ŒíŠ¸ì¸ `LoadingSpinner`ê°€ ë…¸ì¶œë˜ë‹¤ê°€, `fetching`ì´ ì™„ë£Œë˜ê³  `fresh`ìƒíƒœì¼ ë•Œì—ëŠ”, `Event`ì»´í¬ë„ŒíŠ¸ë¥¼ ì •ìƒì ìœ¼ë¡œ ë Œë”ë§í•œë‹¤.

## ğŸ› ì—ëŸ¬ í•¸ë“¤ë§ê³¼ ë¶ˆì™„ì „í•¨

`React`ì˜ `Suspense`ì™€ `React-Query`ë¥¼ ì ì ˆíˆ ì‚¬ìš©í•˜ì—¬, ë°ì´í„°ì˜ ë¡œë”© ìƒíƒœë¥¼ ê°„ë‹¨í•˜ê²Œ êµ¬í˜„í•´ë‚¼ ìˆ˜ ìˆì—ˆë‹¤.

í•˜ì§€ë§Œ ì•„ì§ ë¹„ë™ê¸° ì‘ì—…ì—ì„œ ë°œìƒí•˜ëŠ” ì—ëŸ¬ì— ëŒ€í•œ í•¸ë“¤ë§ì— ëŒ€í•´ì„œëŠ” í•´ê²°í•˜ì§€ ëª»ë‹¤.

ë˜í•œ, `React`, `React-Query` ëª¨ë‘ `suspense`ê¸°ëŠ¥ì— ìˆì–´ì„œëŠ” ì•„ì§ ì‹¤í—˜ë‹¨ê³„ë¼ì„œ ë¶ˆì™„ì „í•œ ìƒíƒœë¼ê³  í•œë‹¤.

ì‹¤ì œë¡œ, ì ìš©í•œ í”„ë¡œì íŠ¸ì—ì„œë„ ë¹„ìŠ·í•œ ì—ëŸ¬ê°€ ìˆì—ˆëŠ”ë° ì—ëŸ¬ í•¸ë“¤ë§, ê·¸ë¦¬ê³  ë°œìƒí–ˆë˜ ì˜¤ë¥˜ì— ìˆì–´ì„œëŠ” ë‹¤ìŒì— ë‹¤ì‹œ ë³µê¸°í•´ë³´ì.

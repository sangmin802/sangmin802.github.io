---
title: 'webSocket Protocol'
date: 2021-05-07 16:44:00
category: 'Study'
draft: false
tag: 'Think'
---

> 21-12-03 ì—…ë°ì´íŠ¸

### ğŸ“¡ ì‘ë‹µì„ í•´ì£¼ëŠ” ì„œë²„

ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚´ê³ , ìš”ì²­ì— ë§ëŠ” ì‘ë‹µì„ í•´ì£¼ëŠ” ê²ƒ. ì„œë²„ì™€ ê´€ë ¨ëœ ê²ƒì„ ì¡°ê¸ˆì”© ì•Œì•„ê°€ë©´ì„œ í˜¸ê¸°ì‹¬ì´ ìƒê²¼ì—ˆë‹¤.

ëˆ„êµ°ê°€ì—ê²Œ ì‘ë‹µì„ ë°›ëŠ”ê²ƒ. ëˆ„êµ°ê°€ì—ê²Œ ë©”ì‹œì§€ë¥¼ ì „ë‹¬ë°›ëŠ” ê²ƒ.

> ì¹´ì¹´ì˜¤í†¡ì´ë„¤?

ë‹¨ìˆœíˆ ìƒê°í•´ë³´ë©´ ë‚´ê°€ ë³´ë‚¸ ë©”ì‹œì§€ë¥¼ ì„œë²„ì—ì„œ ì €ì¥í•˜ê³ , ëˆ„êµ°ê°€ì—ê²Œ ëŒë ¤ì¤€ë‹¤ë©´ ê·¸ê²ƒì´ ì±„íŒ…ì´ ì•„ë‹ê¹Œ? ë¼ëŠ” ìƒê°ì„ í•˜ê²Œ ë˜ì—ˆë‹¤.

### ğŸ¶ í•œê³„

í•˜ì§€ë§Œ, í° ë¬¸ì œê°€ ìˆì—ˆë‹¤.

ìš°ë¦¬ê°€ í”íˆ ì‚¬ìš©í•˜ëŠ” HTTP ë°©ì‹ì€ ë‚´ê°€ ìš”ì²­ì„ ë³´ëƒˆì„ ë•Œ, ê·¸ê²ƒì— ë§ëŠ” ì‘ë‹µë§Œ ì„œë²„ì—ì„œ ëŒë ¤ì¤€ë‹¤.

ì¦‰, ì„œë²„ê°€ ìš”ì²­ì—†ì´ ìŠ¤ìŠ¤ë¡œ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì‘ë‹µí•˜ëŠ”ê²½ìš°ëŠ” ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤.

ì‚¬ì‹¤ ì±„íŒ…ì´ë€ê²ƒì´ ë‚´ê°€ ì•„ë¬´ëŸ° ìš”ì²­ì„ í•˜ì§€ ì•Šì•„ë„, ìƒëŒ€ë°©ì´ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ê²Œëœë‹¤ë©´, ì„œë²„ì—ì„œ ê·¸ ë©”ì‹œì§€ë¥¼ ë‚˜ì—ê²Œ ëŒë ¤ì¤˜ì•¼í•œë‹¤.

ë§ˆì¹˜ **ì‹¤ì‹œê°„ í†µì‹ **ì„ í•˜ëŠ” ê²ƒì²˜ëŸ¼

## ğŸ webSocket

ë‘ê°œì˜ í”„ë¡œê·¸ë¨ê°„ ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ëŠ”ê²ƒ.

> í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ê°„ ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ëŠ”ê²ƒ.

`http`í†µì‹ ì´ë‘ ê°™ì•„ë³´ì´ì§€ë§Œ, í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì´ ì „ë‹¬ë˜ì–´ì•¼ë§Œ ì„œë²„ê°€ ì‘ë‹µì„ í•˜ëŠ” ìˆ˜ë™ì ì¸ ê²ƒì´ ì•„ë‹Œ, ì„œë²„ì—ì„œë„ ëŠ¥ë™ì ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë¬´ì–¸ê°€ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆìŒ.

> ë…¸ë§ˆë“œì½”ë” ì˜ìƒì—ì„œëŠ”, ìš”ì²­ì„ ì „ë‹¬í•˜ê³  ìˆ˜ì‹ í•˜ì˜€ì„ ë•Œ ì—°ê²°ì´ ëŠê¸°ëŠ”ê²ƒì´ ì•„ë‹Œ ì²« `connection`ì„ í†µí•´ ì—°ê²° ìƒíƒœë¥¼ ìœ ì§€í•˜ê³  ì„œë¡œ êµí™˜í•œë‹¤ê³  ì–˜ê¸°í•˜ì‹¬.

1. ì–‘ë°©í–¥ í†µì‹ ì´ ê°€ëŠ¥í•¨.
   ìœ„ì—ì„œ ì„¤ëª…ëœ íŠ¹ì§•

2. ì‹¤ì‹œê°„ ë„¤íŠ¸ì›Œí‚¹
   ì±„íŒ…, ì£¼ì‹ê³¼ ê°™ì´ ì •í•´ì§„ ì‹œê°„ì´ ì•„ë‹Œ ëœë¤í•œ ì‹œê°„ì— ë°œìƒí•˜ëŠ” ë°ì´í„°ë¥¼ ê·¸ë•Œë§ˆë‹¤ í´ë¼ì´ì–¸íŠ¸ì— ë°˜ì˜ì´ ë˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•¨

`WebSocket`ì´ì „, ìœ„ì˜ ì–‘ë°©í–¥ í†µì‹ , ì‹¤ì‹œê°„ ë„¤íŠ¸ì›Œí‚¹ì´ë¼ëŠ” íŠ¹ì§•ì´ í•„ìš”í•œ í”„ë¡œê·¸ë¨ì—ì„œ ì‚¬ìš©í–ˆë˜ ë°©ë²•ì´ ìˆë‹¤ê³  í•¨.

### HTTP Polling

ì¼ì • ì£¼ê¸°ë§ˆë‹¤ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì„œë²„ìƒìœ¼ë¡œ ìš”ì²­ì„ ì†¡ì‹ í•¨. í•˜ì§€ë§Œ, ì±„íŒ…ê³¼ ê°™ì€ í”„ë¡œê·¸ë¨ì—ì„œ ì •í•´ì§„ ì‹œê°„ì— ìƒˆë¡œìš´ ë°ì´í„°ê°€ í˜•ì„±ë˜ëŠ”ê²ƒì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì—, **ë¶ˆí•„ìš”í•œ ìš”ì²­**ì´ ìƒê¸¸ìˆ˜ ìˆê³ , **ì‹¤ì‹œê°„ì´ë¼ê³  í•˜ê¸°ì—” ì• ë§¤**í•¨.

### HTTP Long Polling

ì •í•´ì§„ ì‹œê°„ì— ìš”ì²­ì„ ë³´ë‚´ì–´ ë¶ˆí•„ìš”í•œ ìš”ì²­ì´ ë°œìƒí•˜ê±°ë‚˜, ë³€ê²½ëœ ìƒˆë¡œìš´ ë°ì´í„°ê°€ ìƒê¸°ìë§ˆì í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë³´ë‚¼ ìˆ˜ ì—†ë‹¤ëŠ” ë¬¸ì œë¥¼ ê°œì„ í•˜ê¸° ìœ„í•´ì„œ ì²˜ìŒ ì„œë²„ì— ìš”ì²­ì´ ì „ë‹¬ë˜ì—ˆì„ ë•Œ, ë³€í™”ê°€ ìƒê¸¸ë•Œê¹Œì§€ ëŒ€ê¸°í•˜ë‹¤ê°€ ìƒê¸°ë©´ í´ë¼ì´ì–¸íŠ¸ë¡œ ì‘ë‹µ.

> ì–´ì°Œë˜ì—ˆë“ , ë§ì€ ì–‘ì˜ ë©”ì‹œì§€ê°€ ë°œìƒí•œë‹¤ë©´ ê·¸ ì£¼ê¸°ê°€ ì§§ì•„ì§€ë©´ì„œ `Polling`ê³¼ ë‹¤ë¥¼ê²ƒì´ ì—†ê²Œëœë‹¤ í•¨.

### HTTP Streaming

ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚´ê³  ì—°ê²°ì„ ëŠì§€ ì•Šì€ ìƒíƒœì—ì„œ ë°ì´í„°ë¥¼ ê³„ì†í•´ì„œ ë°›ì•„ì˜´.

í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì˜ìƒì •ë³´ë¥¼ ë³´ë‚´ëŠ”ê²ƒì´ ëŒ€í‘œì ì´ë¼ê³  í•¨.

> ì•„ë§ˆ ìœ íŠœë¸Œ, íŠ¸ìœ„ì¹˜ì™€ ê°™ì€ ì¸í„°ë„· ë°©ì†¡ í”Œë«í¼ì—ì„œ ì´ì™€ê°™ì€ íŠ¹ì§•ì´ ì´ìš©ë˜ëŠ”ê²ƒì´ ì•„ë‹ê¹Œ ìƒê°í•´ë´„

ë‹¤ë§Œ ì²˜ìŒ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìš”ì²­ì´ ì „ë‹¬ëœ ì´í›„ì—ëŠ” ë³„ë‹¤ë¥¸ ìš”ì²­ì—†ì´ ì—°ê²°ëœ ìƒíƒœë¡œ ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ìƒì— ì¡°ê¸ˆì”© ê³„ì†í•´ì„œ ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ëŠ”ê²ƒì´ê¸° ë•Œë¬¸ì— í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì„œë²„ë¡œ ë°ì´í„°ì†¡ì‹ ì´ ì–´ë µë‹¤ê³  í•¨.

> ê·¸ë˜ì„œ í´ë¼ì´ì–¸íŠ¸ìƒìœ¼ë¡œ ì˜ìƒì„ ì˜ê°œ ë‚˜ëˆ„ì–´ì„œ ì „ì†¡í•˜ëŠ”ë°ì— ì£¼ë¡œ ì“°ì´ëŠ”ê²ƒ ê°™ìŒ.

ëª¨ë‘ ê³µí†µì ìœ¼ë¡œ `HTTP`í†µì‹ ì„ ì‚¬ìš©í•˜ëŠ” í™˜ê²½ì—ì„œ ë°ì´í„°ë¥¼ ë¹ ë¥´ê²Œ, ì‹¤ì‹œê°„ì„ ëª©ì ìœ¼ë¡œ ì£¼ê³ ë°›ì•„ì•¼ í•˜ë‹¤ë³´ë‹ˆ ê·œëª¨ê°€ í° `header`ê°€ ìì£¼ êµí™˜ë˜ëŠ” ìƒí™©ì´ë¼ê³  í•œë‹¤.

### ì—°ê²°

`WebSocket`ë„ ì¼ë°˜ ì„œë²„ì™€ì˜ í†µì„ ì¹˜ëŸ¼ **í•¸ë“œì‰ì´í‚¹**ì˜ ê³¼ì •ì„ ê±°ì¹œë‹¤ê³  í•¨

> í•¸ë“œì‰ì´í‚¹. ì²˜ìŒë³´ì§€ë§Œ ëŒ€ëµì ìœ¼ë¡œ ì˜ë¯¸ë¥¼ ì•Œì•„ë³´ë‹ˆ, í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì„œë²„ë¡œ ì—°ê²° ìš”ì²­ì„ ë³´ë‚´ê³ , ì„œë²„ì—ì„œëŠ” ì—°ê²° ì‘ë‹µì„ í´ë¼ì´ì–¸íŠ¸ì— ë³´ë‚´ì–´ì„œ ì„œë¡œì˜ ì—°ê²° ê³¼ì •ì„ í•¸ë“œì‰ì´í‚¹ì´ë¼ê³  í•˜ëŠ”ê²ƒ ê°™ë‹¤. ë” ì•Œì•„ë³´ì.

`http(80)`, `https(443)` í”„ë¡œí† ì½œì„ ì‚¬ìš©í•˜ì—¬ ì„œë²„ì— ìš”ì²­ì„ ì „ë‹¬í•˜ëŠ”ë°, í•µì‹¬ `header` ì†ì„±ë“¤ì´ ìˆë‹¤ê³  í•œë‹¤.

```js
// GET /chat
const header = {
  Host: javascript.info
  Origin: https://javascript.info
  Connection: Upgrade
  Upgrade: websocket
  Sec-WebSocket-Key: Iv8io/9s+lYFgZWcXczP8Q==
  Sec-WebSocket-Version: 13
}
```

`Origin` : `webSocket`ì—°ê²°ì„ í•  í´ë¼ì´ì–¸íŠ¸ ì£¼ì†Œ
`Connection`: í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ í”„ë¡œí† ì½œì„ ë³€ê²½í•˜ê³ ì‹¶ë‹¤ëŠ” ìš”ì²­
`Upgrade` : í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ ë³€ê²½í•˜ê³ ì‹¶ì€ í”„ë¡œí† ì½œ
`Sec-WebSocket-Key` : ì—°ê²°ë˜ëŠ” í”„ë¡œí† ì½œì˜ ë³´ì•ˆì„ ìœ„í•œ í‚¤

ì´ë ‡ê²Œ ì „ì†¡ì´ ë˜ë©´ ì„œë²„ì—ì„œëŠ” `webSocket`ì´ ì—°ê²°ë˜ì—ˆë‹¤ëŠ” ì‘ë‹µì„ í´ë¼ì´ì–¸íŠ¸ë¡œ ì „ì†¡í•œë‹¤.

ì´ ì´í›„ì—ëŠ” `http`í”„ë¡œí† ì½œì´ ì•„ë‹Œ `ws80` í˜¹ì€ `wss(443)` í”„ë¡œí† ì½œì´ ì ìš©ëœë‹¤ê³  í•œë‹¤.

> `wss`ëŠ” `https`ì²˜ëŸ¼ `SSL` ë³´ì•ˆ ì¸ì¦ì´ ì ìš©ëœ í”„ë¡œí† ì½œì´ë¼ê³  í•¨

### ë°ì´í„° ì „ì†¡

`webSocket` í”„ë¡œí† ì½œë¡œ ì—°ê²°ëœ í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ê°„ ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ëŠ” êµ¬ì¡°ë¥¼ `webSocket frame`ë¼ê³  í•œë‹¤.

`frame`ì€ `header`ì™€ `payload`ë¡œ êµ¬ì„±ë˜ì–´ìˆë‹¤ê³  í•¨.

ì „ë‹¬ë˜ëŠ” `frame`ì˜ í¬ê¸°ì— ë”°ë¼ `frame header`ê°€ ë‹¤ë¥¸ êµ¬ì¡°ë¥¼ ê°–ëŠ”ë‹¤ëŠ”ê²ƒ ê°™ë‹¤.

`header`ì˜ `OPCODE`ë¥¼ í†µí•´ í•´ë‹¹ `frame`ì´ í…ìŠ¤íŠ¸ í”„ë ˆì„ì¸ì§€, ì´ì§„ ë°ì´í„° í”„ë ˆì„ì¸ì§€ ì•„ë‹ˆë©´ `webSocket`ì»¤ë„¥ì…˜ì„ ì¢…ë£Œí•˜ëŠ” í”„ë ˆì„ì¸ì§€ êµ¬ë¶„í•œë‹¤ê³  í•¨.

> ê°€ì¥ ë§ì´ ì‚¬ìš©í•œë‹¤ëŠ” ê²ƒë“¤ë§Œì„ ê³¨ë¼ë´„..

ì´í›„ì— í•¨ê»˜ ì „ë‹¬ëœ `UTF-8` í˜•ì‹ì˜ `payload`ë¥¼ ì•Œì•„ë³¼ìˆ˜ ìˆëŠ” ì¼ë°˜ í…ìŠ¤íŠ¸ë¡œ ë””ì½”ë”©í•˜ëŠ”ê²ƒ ê°™ë‹¤

### webSocket í”„ë¡œí† ì½œ íŠ¹ì§•

1. ì²˜ìŒ ì ‘ì†ì—ì„œë§Œ `http` í”„ë¡œí† ì½œì„ ì‚¬ìš©í•˜ì—¬ í•¸ë“œì‰ì´í‚¹ì„ í•˜ê¸° ìœ„í•´ í•œë²ˆë§Œ `http header`ë¥¼ ì‚¬ìš©í•œë‹¤.
2. ë‹¤ë¥¸ í¬íŠ¸ê°€ ì•„ë‹Œ ê¸°ì¡´ì˜ `http`, `https` í”„ë¡œí† ì½œì„ ì‚¬ìš©í•¨
3. `webSocket`ì—°ê²°ê°„ ë°ì´í„°ë¥¼ êµí™˜í•˜ëŠ” êµ¬ì¡°ëŠ” `webSocket frame`ì„ ì‚¬ìš©í•¨

### í•œê³„

`HTML5`ë¶€í„° ì†Œê°œëœ ê¸°ìˆ ë¡œ ì´ì „ì˜ ë²„ì „ì—ì„œëŠ” í˜¸í™˜ë˜ì§€ ì•ŠëŠ” ìƒí™©ì´ ë°œìƒí•¨.

`Socket.io`, `SockJS`ì™€ ê°™ì€ ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ `webSocket`ì„ í˜¸í™˜í•˜ì§€ ëª»í•˜ëŠ” ë²„ì „ì—ì„œ íŠ¹ì§•ì¸ ì‹¤ì‹œê°„ ì›¹ì„ êµ¬í˜„í•˜ë„ë¡ ë„ì™€ì¤Œ

ë¸Œë¼ìš°ì €ì™€ ì›¹ ì„œë²„ì˜ ì¢…ë¥˜, ë²„ì „ì„ íŒŒì•…í•˜ì—¬ ì í•©í•œ ê¸°ìˆ ì„ ì„ íƒí•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ë°©ì‹

### ğŸ“ Socket.io

`Web Socket`ì€ `HTML5`ì˜ ê¸°ìˆ ì´ê¸° ë•Œë¬¸ì—, ì˜¤ë˜ëœ ë²„ì „ì˜ ì›¹ ë¸Œë¼ìš°ì €ì—ì„œëŠ” `Web Socket`ì„ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤ê³ í•œë‹¤.

> ëŒ€í‘œì ì¸ `IE`.. ìš”ì¦˜ `IE`ì— ëŒ€í•œ ì§€ì›ì´ ëŒ€ë¶€ë¶„ ëŠê¸°ê³  ìˆë‹¤ë¼ëŠ” ì¹´ë”ë¼ í†µì‹ (feat Youtube)

ì´ì²˜ëŸ¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ë¥¼ ìœ„í•´ ìƒê¸´ê²ƒì´ `Socket.io`ë¼ê³  í•œë‹¤.

`Socket.io`ëŠ” `Node.js`ê¸°ë°˜ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ ê¸°ìˆ ë¡œ, ê±°ì˜ ëª¨ë“  ì›¹ë¸Œë¼ìš°ì €ì™€ ëª¨ë°”ì¼ ì¥ì¹˜ë¥¼ ì§€ì›í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¼ê³  í•œë‹¤.

ë§Œì•½, `Web Socket`ì„ ì§€ì›í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¼ë©´ í•´ë‹¹ ê¸°ìˆ ì„ ì‚¬ìš©í•˜ê³ , ê·¸ë ‡ì§€ ì•Šì€ ë¸Œë¼ìš°ì €ë¼ë©´ ê¸°ì¡´ì˜ `HTTP`ë¥¼ ì´ìš©í•´ì„œ í‰ë‚´ë¥¼ ë‚¸ë‹¤ê³  í•œë‹¤.

> ì–´ë–»ê²Œ í‰ë‚´ë¥¼ ë‚´ëŠ”ê±°ì§€..?

## ğŸ­ ê°„ë‹¨í•œ ì±„íŒ… êµ¬í˜„

> `Socket.io`ëŠ” ê³µì‹ì‚¬ì´íŠ¸ì—ì„œ ê°„ë‹¨í•œ ì˜ˆì œë¥¼ í†µí•´ ì²´í—˜í•´ ë³¼ ìˆ˜ ìˆëŠ” ì½”ë“œì™€, ê°ì¢… `API`ë¥¼ ì •ë¦¬í•´ë†“ì€ ë¬¸ì„œê°€ ìˆìœ¼ë‹ˆ í•œë²ˆ ê°€ë³´ëŠ”ê²Œ ì¢‹ì„ë“¯ í•˜ë‹¤! - ì•„ë˜ ì°¸ê³  í™•ì¸

ê³µì‹ ì‚¬ì´íŠ¸ì— ë‚˜ì™€ìˆëŠ” ê°„ë‹¨í•œ ì±„íŒ… ì‚¬ì´íŠ¸ë¥¼ êµ¬í˜„í•´ë³¸ ê²½í—˜ì´ë‹¤.

> í™•ì¸í•´ë³´ê³ ì‹¶ì€ íŠ¹ì • ìƒí™©ë“¤ì´ ìˆì–´, ì‚´ì§ ìˆ˜ì •í•˜ì˜€ë‹¤.

ë””ë ‰í† ë¦¬ êµ¬ì¡°

<div style="margin : 0 auto; text-align : center">
  <img src="/img/2021/05/07/1.PNG" alt="1">
</div>

### ğŸ¥ server

```js
const path = require('path')
const express = require('express')
const app = express()
const http = require('http')
const server = http.createServer(app)
const port = 3000
const { Server } = require('socket.io')
const io = new Server(server)
const basePath = path.join(__dirname, '..', '/')

app.get('/', (req, res) => {
  res.sendFile(basePath + 'public/index.html')
})

app.get('/room', (req, res) => {
  res.sendFile(basePath + 'public/room.html')
})

io.on('connection', socket => {
  // ì†Œí‚· ì—°ê²°
  console.log('Socket Connected')

  // ì…ì¥ ê°ì§€Â·ë°˜í™˜
  socket.on('join', name => {
    // ë‚˜ë¥¼ ì œì™¸í•œ ì—°ê²°ëœ ëª¨ë“  ì‚¬ìš©ìì—ê²Œ ì „ë‹¬ - broadcast.emit
    // socket.broadcast.emit("join", name);
    // ë‚˜ë¥¼ í¬í•¨í•œ ëª¨ë“  ì‚¬ìš©ìì—ê²Œ ì „ë‹¬ - emit
    io.emit('join', name)
  })

  // í‡´ì¥ ê°ì§€Â·ë°˜í™˜
  //    í˜„ì¬ ì ‘ì†í•œ ê³³ì´ ì±„íŒ…ë°©ì´ì—¬ì„œ, í‡´ì¥í•˜ë©´ ì†Œí‚· ì¢…ë£Œì‹œí‚´
  socket.on('leave', name => {
    io.emit('leave', name)
    // socket.broadcast.emit("leave", name);
    socket.disconnect(true)
  })

  // ì±„íŒ… ê°ì§€Â·ë°˜í™˜
  socket.on('chat', msg => {
    io.emit('chat', msg)
  })

  // ì†Œí‚· ì¢…ë£Œ
  socket.on('disconnect', () => {
    console.log('Socket Disconnected ')
  })
})

server.listen(port, () => {
  console.log(`Server is connected on ${port}`)
})
```

- ì „ë°˜ì ìœ¼ë¡œ ë³´ì•˜ì„ ë•Œ, `.on` ì´ë¼ëŠ” `API`ê°€ í´ë¼ì´ì–¸íŠ¸ `Socket` ì—ì„œì˜ ìš”ì²­ì„ ì„œë²„ì˜ `Socket`ì—ì„œ ë°›ì„ ë•Œ ì‚¬ìš©í•˜ëŠ”ê²ƒ ê°™ë‹¤.
- `.emit`ì€ `.on`ê³¼ ë°˜ëŒ€ë¡œ, ì„œë²„ì˜ `Socket`ì—ì„œ í´ë¼ì´ì–¸íŠ¸ì˜ `Socket`ìœ¼ë¡œ ë³´ë‚´ì£¼ëŠ” ì—­í™œì„ í•œë‹¤.
- `connection`, `disconnect`ì™€ ê°™ì´ `Socket`ì—ì„œ ì •í•œ ë„¤ì´ë°ë„
  ìˆì§€ë§Œ, `join`, `leave`ì™€ ê°™ì€ê²ƒì€ ì»¤ìŠ¤í…€í•œ ë„¤ì´ë°ì´ë‹¤.
  > ì»¤ìŠ¤í…€ ì´ë²¤íŠ¸ì²˜ëŸ¼ ì´ ë„¤ì´ë°ì´ ì´í›„ì˜ ì½œë°±í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ëŠ” ì´ë²¤íŠ¸ í‚¤ë¼ê³  ë³´ëŠ”ê²Œ ì¢‹ì„ë“¯ í•˜ë‹¤.
- í˜„ì¬ëŠ”, `Socket`ì— ì ‘ì†í•˜ë©´ ë°”ë¡œ ì±„íŒ…ì— ì°¸ì—¬í•˜ëŠ”êµ¬ì¡°ì´ì§€ë§Œ, `Room`ì´ë¼ëŠ” ê°œë…ê³¼ `.to` `API`ë¥¼ í†µí•´ ìƒí˜¸ì‘ìš©ì—ëŒ€í•œ ê²ƒì„ êµ¬ë¶„ì§€ì„ìˆ˜? ìˆëŠ”ê²ƒ ê°™ì•˜ë‹¤.
  > ì¼ì¢…ì˜ ì¹´ì¹´ì˜¤í†¡ ëŒ€í™”ë°© ê°™ì€?

### ğŸ– index.html

```js
<a href="room">ë°©ìœ¼ë¡œ ì´ë™</a>
```

- `connection`ì— ëŒ€í•œ ê²°ê³¼ë¥¼ ë³´ê³ ì‹¶ì–´, `Socket`ì´ ì‹¤í–‰ë˜ëŠ” ê²½ë¡œë¥¼ êµ¬ë¶„ì§€ì–´ë†“ê¸° ìœ„í•´ ì¶”ê°€í•˜ì˜€ë‹¤.
  > ë³„ ì˜ë¯¸ëŠ” ì—†ìŒ..

### ğŸ” room.html

```js
// Socket CDN
<script src="/socket.io/socket.io.js"></script>

// html
<div class="bar">
  <button id="out">Out</button>
</div>
<div id="messages"></div>
<form id="form" class="bar" action="">
  <input id="input" autocomplete="off" /><button>Send</button>
</form>

// script
const form = document.querySelector("#form");
const input = document.querySelector("#input");
const messages = document.querySelector("#messages");
const out = document.querySelector("#out");
const name = "ìƒë¯¼";

// ì†Œí‚· ì—°ê²°
const socket = io();

// ë‚˜ì˜ ì…ì¥ì„ ëª¨ë‘ì—ê²Œ ì•Œë¦¼
socket.emit("join", name);

// ëˆ„êµ°ê°€ ì…ì¥í–ˆì„ ë•Œ ì•Œë¦¼ ë°›ìŒ
socket.on("join", name => {
  recordChat(`${name} ë‹˜ì´ ì…ì¥í•˜ì…¨ìŠµë‹ˆë‹¤.`);
});

// ì±„íŒ… ì…ë ¥
form.addEventListener("submit", e => {
  e.preventDefault();
  if (input.value) {
    socket.emit("chat", { name, msg: input.value });
    input.value = "";
  }
});

// ëˆ„êµ°ê°€ì˜ ì±„íŒ… ë°›ì•„ì˜´
socket.on("chat", ({ name, msg }) => {
  recordChat(`${name} : ${msg}`);
});

// ë‚´ê°€ ë– ë‚˜ê¸° ìœ„í•œ ë²„íŠ¼
out.addEventListener("click", e => {
  e.preventDefault();
  socket.emit("leave", name);
});

// ëˆ„êµ°ê°€ ë– ë‚¬ì„ ë•Œ ì•Œë¦¼ ë°›ì•„ì˜´
socket.on("leave", name => {
  recordChat(`${name} ë‹˜ì´ í‡´ì¥í•˜ì…¨ìŠµë‹ˆë‹¤.`);
});

function recordChat(msg) {
  const item = document.createElement("p");
  item.textContent = msg;
  messages.appendChild(item);
  window.scrollTo(0, document.body.scrollHeight);
}
```

- ì„œë²„ì˜ `Socket`ê³¼ ë™ì¼í•˜ê²Œ, `on`ìœ¼ë¡œ íŠ¹ì • ì´ë²¤íŠ¸ í‚¤ì— ëŒ€í•œ ê°ì§€ë¥¼ í•˜ê³ , `.emit`ìœ¼ë¡œ íŠ¹ì • ì´ë²¤íŠ¸ í‚¤ì— ëŒ€í•œ ìš”ì²­ì„ ë³´ë‚¸ë‹¤.
- `const socket = io();` ì´ ë¶€ë¶„ì—ì„œ, `url`ì„ ì¸ìë¡œ ë³´ë‚´ ë™ì¼ í¬íŠ¸ê°€ ì•„ë‹Œ ë‹¤ë¥¸ í¬íŠ¸ë¡œ ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ë„ ìˆëŠ”ê²ƒ ê°™ì•˜ë‹¤.
  > ë¬¼ë¡ , ì„œë²„ì—ì„œ `cors`ì™€ ê´€ë ¨ë˜ì–´ í—ˆìš© ì£¼ì†Œë¡œ ì§€ì •í•´ì¤˜ì•¼ í•¨.
- í˜„ì¬ëŠ” ë°”ë¡œ `Socket`ì— ì ‘ì†í•˜ë„ë¡ ë˜ì–´ìˆì§€ë§Œ, í•„ìš”ì— ë”°ë¼ ì‚¬ìš©ìê°€ ì›í•  ë•Œ `connect`ë¥¼ í•  ìˆ˜ ìˆë„ë¡ í•  ìˆ˜ ìˆë‹¤ê³  í•œë‹¤.

## ğŸŒ® ê²°ê³¼

### ğŸ¥§ ì±„íŒ… ì°¸ì—¬ - í‡´ì¥ / í´ë¼ì´ì–¸íŠ¸

<div style="margin : 0 auto; text-align : center">
  <img src="/img/2021/05/07/2.gif" alt="2">
</div>

- ì›ë˜ëŒ€ë¡œë¼ë©´, í‡´ì¥í•˜ì˜€ì„ ë•Œ ë‹¤ì‹œ `index.html`ë¡œ ëŒì•„ê°€ì§€ë§Œ, í‡´ì¥í–ˆë‹¤ëŠ” ë¬¸êµ¬ê°€ ì˜ ëœ¨ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ì´ë™í•˜ì§„ ì•Šì•˜ë‹¤.

### ğŸ· ì±„íŒ… ì°¸ì—¬ - í‡´ì¥ / ì„œë²„

<div style="margin : 0 auto; text-align : center">
  <img src="/img/2021/05/07/3.gif" alt="3">
</div>

- ì´ê²Œ ë­”ê°€ ì‹¶ê² ì§€ë§Œ, `room.html`ë¡œ ì´ë™í•˜ì˜€ì„ ë•Œ, `Socket Connected`ê°€ ì„œë²„ì—ì„œ í˜¸ì¶œë˜ê³ , í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë‚˜ê°€ê¸°ë¥¼ ëˆŒë €ì„ ë•Œ, ì„œë²„ì—ì„œ `Socket Disconnected`ê°€ í˜¸ì¶œëœë‹¤.
- ë‹¹ì—°íˆ, `Socket Disconnected`ê°€ í˜¸ì¶œëœ ë’¤ë¡œëŠ” í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë¬´ìŠ¨ ì±„íŒ…ì„ ì²˜ë„ ì•„ë¬´ëŸ° ë³€í™”ê°€ ì—†ë‹¤.

## ğŸ¥® í›„ê¸°

ì •ë§ ì¬ë¯¸ìˆëŠ”ê²ƒ ê°™ë‹¤. ì¹´ì¹´ì˜¤í†¡ì´ë‘ ë¹„ìœ ë¥¼ í•´ë³¸ë‹¤ë©´

1. ì¹´ì¹´ì˜¤í†¡ ë¡œê·¸ì¸ - `Socket Connect`
2. ëŒ€í™”ë°© - `Socket Room`

   - ëŒ€í™”ë°©ì˜ ì´ì „ ëŒ€í™”ë‚´ìš©ì€ `DB`ë¡œ ì €ì¥í•˜ê³ , í•´ë‹¹ ë°©ì— ì…ì¥í–ˆì„ ë•Œ ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë°©ì‹
   - ê°ê°ì˜ ëŒ€í™”ë°©ì— ëŒ€í•œ ë³€í™”(ê°™ì€ `id`ì˜ ëŒ€í™”ë°©ì„ ì‚¬ìš©í•˜ê³ ìˆëŠ” ì‚¬ëŒì˜ ì±„íŒ…)ë¥¼ ì„œë²„ì—ì„œëŠ” `.emit`ìœ¼ë¡œ ë³´ë‚´ê³ , í´ë¼ì´ì–¸íŠ¸ì—ì„œëŠ” `.on`ìœ¼ë¡œ ê°ì§€í•¨
     > ë§Œì•½ `React`ë¼ë©´, `.on`ìœ¼ë¡œ ë°›ì•„ì˜¨ íšŸìˆ˜ë¥¼ ì¹´ìš´íŒ…í•˜ì—¬ ëˆ„ì ëœ ìƒˆë¡œìš´ ë©”ì‹œì§€ ê°¯ìˆ˜ ì¶œë ¥?
     > ê°€ì¥ ìµœì‹ ì˜ ëŒ€í™”ë§Œ `thumbnail`ë¡œ ë…¸ì¶œ

3. ì¹´ì¹´ì˜¤í†¡ ë¡œê·¸ì•„ì›ƒ - `Socket disConnect`

ì´ëŸ° ëŠë‚Œì´ì§€ ì•Šì„ê¹Œ..?

> ê±´ë°©ì§€ê²Œ ê°íˆ ì˜ˆìƒì„ í•´ë³´ì•˜ë‹¤.

## ğŸ© ì°¸ê³ 

- [Socket ì´ë€](https://medium.com/@yeon22/term-socket%EC%9D%B4%EB%9E%80-7ca7963617ff)
- [Web Socket ì´ë€](https://edu.goorm.io/learn/lecture/557/%ED%95%9C-%EB%88%88%EC%97%90-%EB%81%9D%EB%82%B4%EB%8A%94-node-js/lesson/174379/web-socket%EC%9D%B4%EB%9E%80)
- [Soket.io](https://socket.io/)
- [ìš°í…Œì½” webSocket](https://www.youtube.com/watch?v=MPQHvwPxDUw)
- [MDN webSocket](https://developer.mozilla.org/ko/docs/Web/API/WebSockets_API/Writing_WebSocket_servers)
- [webSocket Protocol](https://swiftymind.tistory.com/104)
- [javascript webSocket](https://ko.javascript.info/websocket)

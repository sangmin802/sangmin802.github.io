{"componentChunkName":"component---src-templates-blog-post-js","path":"/Study/CS/socket/","result":{"data":{"site":{"siteMetadata":{"title":"SangMin 개발 이야기","author":"SangMin","siteUrl":"https://sangmin802.github.io","comment":{"disqusShortName":"","utterances":"sangmin802/sangmin802.github.io"},"sponsor":{"buyMeACoffeeId":"jbee"}}},"markdownRemark":{"id":"a88b9c52-06fe-5d5a-9575-f1456ecf525e","excerpt":"📡 응답을 해주는 서버 서버에 요청을 보내고, 요청에 맞는 응답을 해주는 것. 서버와 관련된 것을 조금씩 알아가면서 호기심이 생겼었다. 누군가에게 응답을 받는것. 누군가에게 메시지를 전달받는 것. 카카오톡이네? 단순히 생각해보면 내가 보낸 메시지를 서버에서 저장하고, 누군가에게 돌려준다면 그것이 채팅이 아닐까? 라는 생각을 하게 되었다. 🐶 한계 하지만, 큰 문제가 있었다. 우리가 흔히 사용하는 HTTP…","html":"<h3 id=\"-응답을-해주는-서버\" style=\"position:relative;\"><a href=\"#-%EC%9D%91%EB%8B%B5%EC%9D%84-%ED%95%B4%EC%A3%BC%EB%8A%94-%EC%84%9C%EB%B2%84\" aria-label=\" 응답을 해주는 서버 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📡 응답을 해주는 서버</h3>\n<p>서버에 요청을 보내고, 요청에 맞는 응답을 해주는 것. 서버와 관련된 것을 조금씩 알아가면서 호기심이 생겼었다.</p>\n<p>누군가에게 응답을 받는것. 누군가에게 메시지를 전달받는 것.</p>\n<blockquote>\n<p>카카오톡이네?</p>\n</blockquote>\n<p>단순히 생각해보면 내가 보낸 메시지를 서버에서 저장하고, 누군가에게 돌려준다면 그것이 채팅이 아닐까? 라는 생각을 하게 되었다.</p>\n<h3 id=\"-한계\" style=\"position:relative;\"><a href=\"#-%ED%95%9C%EA%B3%84\" aria-label=\" 한계 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🐶 한계</h3>\n<p>하지만, 큰 문제가 있었다.</p>\n<p>우리가 흔히 사용하는 HTTP 방식은 내가 요청을 보냈을 때, 그것에 맞는 응답만 서버에서 돌려준다.</p>\n<p>즉, 서버가 요청없이 스스로 클라이언트에게 응답하는경우는 존재하지 않는다.</p>\n<p>사실 채팅이란것이 내가 아무런 요청을 하지 않아도, 상대방이 메시지를 보내게된다면, 서버에서 그 메시지를 나에게 돌려줘야한다.</p>\n<p>마치 <strong>실시간 통신</strong>을 하는 것처럼</p>\n<h2 id=\"-web-socket\" style=\"position:relative;\"><a href=\"#-web-socket\" aria-label=\" web socket permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🍎 Web Socket</h2>\n<p><code class=\"language-text\">Socket</code>이란 네트워크 상에서 동작하는 프로그램 간 통신의 종착점이라고 한다. 사실 우리의 입장에서 보면, 두개의 종착점으로 클라이언트와 서버가 되는 것이다.</p>\n<p><code class=\"language-text\">Web Socket</code>은 <code class=\"language-text\">HTML5</code>의 표준 기술로, 클라이언트와 서버 양 측에 모두 <code class=\"language-text\">Socket</code>을 가지고 있고, 성공적으로 <code class=\"language-text\">connection</code>연결이 된다면 , 클라이언트와 서버 사이의 동적인 양방향 채널을 구성한다.</p>\n<p><code class=\"language-text\">Web Socket API</code>를 통해 실시간으로 데이트를 통신할 수 있는 것이다.</p>\n<h3 id=\"-socketio\" style=\"position:relative;\"><a href=\"#-socketio\" aria-label=\" socketio permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🍓 Socket.io</h3>\n<p><code class=\"language-text\">Web Socket</code>은 <code class=\"language-text\">HTML5</code>의 기술이기 때문에, 오래된 버전의 웹 브라우저에서는 <code class=\"language-text\">Web Socket</code>을 지원하지 않는다고한다.</p>\n<blockquote>\n<p>대표적인 <code class=\"language-text\">IE</code>.. 요즘 <code class=\"language-text\">IE</code>에 대한 지원이 대부분 끊기고 있다라는 카더라 통신(feat Youtube)</p>\n</blockquote>\n<p>이처럼 지원하지 않는 브라우저를 위해 생긴것이 <code class=\"language-text\">Socket.io</code>라고 한다.</p>\n<p><code class=\"language-text\">Socket.io</code>는 <code class=\"language-text\">Node.js</code>기반으로 만들어진 기술로, 거의 모든 웹브라우저와 모바일 장치를 지원하는 라이브러리라고 한다.</p>\n<p>만약, <code class=\"language-text\">Web Socket</code>을 지원하는 라이브러라면 해당 기술을 사용하고, 그렇지 않은 브라우저라면 기존의 <code class=\"language-text\">HTTP</code>를 이용해서 흉내를 낸다고 한다.</p>\n<blockquote>\n<p>어떻게 흉내를 내는거지..?</p>\n</blockquote>\n<h2 id=\"-간단한-채팅-구현\" style=\"position:relative;\"><a href=\"#-%EA%B0%84%EB%8B%A8%ED%95%9C-%EC%B1%84%ED%8C%85-%EA%B5%AC%ED%98%84\" aria-label=\" 간단한 채팅 구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🍭 간단한 채팅 구현</h2>\n<blockquote>\n<p><code class=\"language-text\">Socket.io</code>는 공식사이트에서 간단한 예제를 통해 체험해 볼 수 있는 코드와, 각종 <code class=\"language-text\">API</code>를 정리해놓은 문서가 있으니 한번 가보는게 좋을듯 하다! - 아래 참고 확인</p>\n</blockquote>\n<p>공식 사이트에 나와있는 간단한 채팅 사이트를 구현해본 경험이다.</p>\n<blockquote>\n<p>확인해보고싶은 특정 상황들이 있어, 살짝 수정하였다.</p>\n</blockquote>\n<p>디렉토리 구조</p>\n<div style=\"margin : 0 auto; text-align : center\">\n  <img src=\"/img/2021/05/07/1.PNG\" alt=\"1\">\n</div>\n<h3 id=\"🥞-server\" style=\"position:relative;\"><a href=\"#%F0%9F%A5%9E-server\" aria-label=\"🥞 server permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🥞 server</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> http <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> port <span class=\"token operator\">=</span> <span class=\"token number\">3000</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> Server <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'socket.io'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> io <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Server</span><span class=\"token punctuation\">(</span>server<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> basePath <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'..'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">sendFile</span><span class=\"token punctuation\">(</span>basePath <span class=\"token operator\">+</span> <span class=\"token string\">'public/index.html'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/room'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">sendFile</span><span class=\"token punctuation\">(</span>basePath <span class=\"token operator\">+</span> <span class=\"token string\">'public/room.html'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\nio<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'connection'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">socket</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 소킷 연결</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Socket Connected'</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// 입장 감지·반환</span>\n  socket<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'join'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">name</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 나를 제외한 연결된 모든 사용자에게 전달 - broadcast.emit</span>\n    <span class=\"token comment\">// socket.broadcast.emit(\"join\", name);</span>\n    <span class=\"token comment\">// 나를 포함한 모든 사용자에게 전달 - emit</span>\n    io<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'join'</span><span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// 퇴장 감지·반환</span>\n  <span class=\"token comment\">//    현재 접속한 곳이 채팅방이여서, 퇴장하면 소킷 종료시킴</span>\n  socket<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'leave'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">name</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    io<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'leave'</span><span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// socket.broadcast.emit(\"leave\", name);</span>\n    socket<span class=\"token punctuation\">.</span><span class=\"token function\">disconnect</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// 채팅 감지·반환</span>\n  socket<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'chat'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">msg</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    io<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'chat'</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// 소킷 종료</span>\n  socket<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'disconnect'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Socket Disconnected '</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\nserver<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Server is connected on </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>port<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>전반적으로 보았을 때, <code class=\"language-text\">.on</code> 이라는 <code class=\"language-text\">API</code>가 클라이언트 <code class=\"language-text\">Socket</code> 에서의 요청을 서버의 <code class=\"language-text\">Socket</code>에서 받을 때 사용하는것 같다.</li>\n<li><code class=\"language-text\">.emit</code>은 <code class=\"language-text\">.on</code>과 반대로, 서버의 <code class=\"language-text\">Socket</code>에서 클라이언트의 <code class=\"language-text\">Socket</code>으로 보내주는 역활을 한다.</li>\n<li>\n<p><code class=\"language-text\">connection</code>, <code class=\"language-text\">disconnect</code>와 같이 <code class=\"language-text\">Socket</code>에서 정한 네이밍도\n있지만, <code class=\"language-text\">join</code>, <code class=\"language-text\">leave</code>와 같은것은 커스텀한 네이밍이다.</p>\n<blockquote>\n<p>커스텀 이벤트처럼 이 네이밍이 이후의 콜백함수를 실행하는 이벤트 키라고 보는게 좋을듯 하다.</p>\n</blockquote>\n</li>\n<li>\n<p>현재는, <code class=\"language-text\">Socket</code>에 접속하면 바로 채팅에 참여하는구조이지만, <code class=\"language-text\">Room</code>이라는 개념과 <code class=\"language-text\">.to</code> <code class=\"language-text\">API</code>를 통해 상호작용에대한 것을 구분지을수? 있는것 같았다.</p>\n<blockquote>\n<p>일종의 카카오톡 대화방 같은?</p>\n</blockquote>\n</li>\n</ul>\n<h3 id=\"-indexhtml\" style=\"position:relative;\"><a href=\"#-indexhtml\" aria-label=\" indexhtml permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🍖 index.html</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">&lt;</span>a href<span class=\"token operator\">=</span><span class=\"token string\">\"room\"</span><span class=\"token operator\">></span>방으로 이동<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>a<span class=\"token operator\">></span></code></pre></div>\n<ul>\n<li>\n<p><code class=\"language-text\">connection</code>에 대한 결과를 보고싶어, <code class=\"language-text\">Socket</code>이 실행되는 경로를 구분지어놓기 위해 추가하였다.</p>\n<blockquote>\n<p>별 의미는 없음..</p>\n</blockquote>\n</li>\n</ul>\n<h3 id=\"-roomhtml\" style=\"position:relative;\"><a href=\"#-roomhtml\" aria-label=\" roomhtml permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🍔 room.html</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Socket CDN</span>\n<span class=\"token operator\">&lt;</span>script src<span class=\"token operator\">=</span><span class=\"token string\">\"/socket.io/socket.io.js\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n\n<span class=\"token comment\">// html</span>\n<span class=\"token operator\">&lt;</span>div <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"bar\"</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>button id<span class=\"token operator\">=</span><span class=\"token string\">\"out\"</span><span class=\"token operator\">></span>Out<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>div id<span class=\"token operator\">=</span><span class=\"token string\">\"messages\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>form id<span class=\"token operator\">=</span><span class=\"token string\">\"form\"</span> <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"bar\"</span> action<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>input id<span class=\"token operator\">=</span><span class=\"token string\">\"input\"</span> autocomplete<span class=\"token operator\">=</span><span class=\"token string\">\"off\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>button<span class=\"token operator\">></span>Send<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>form<span class=\"token operator\">></span>\n\n<span class=\"token comment\">// script</span>\n<span class=\"token keyword\">const</span> form <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#form\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> input <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#input\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> messages <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#messages\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> out <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#out\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> name <span class=\"token operator\">=</span> <span class=\"token string\">\"상민\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 소킷 연결</span>\n<span class=\"token keyword\">const</span> socket <span class=\"token operator\">=</span> <span class=\"token function\">io</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 나의 입장을 모두에게 알림</span>\nsocket<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"join\"</span><span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 누군가 입장했을 때 알림 받음</span>\nsocket<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"join\"</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">name</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">recordChat</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> 님이 입장하셨습니다.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 채팅 입력</span>\nform<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"submit\"</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">e</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    socket<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"chat\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> name<span class=\"token punctuation\">,</span> msg<span class=\"token operator\">:</span> input<span class=\"token punctuation\">.</span>value <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    input<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 누군가의 채팅 받아옴</span>\nsocket<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"chat\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> name<span class=\"token punctuation\">,</span> msg <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">recordChat</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> : </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>msg<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 내가 떠나기 위한 버튼</span>\nout<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">e</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  socket<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"leave\"</span><span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 누군가 떠났을 때 알림 받아옴</span>\nsocket<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"leave\"</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">name</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">recordChat</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> 님이 퇴장하셨습니다.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">recordChat</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">msg</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> item <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"p\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  item<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> msg<span class=\"token punctuation\">;</span>\n  messages<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  window<span class=\"token punctuation\">.</span><span class=\"token function\">scrollTo</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>scrollHeight<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>서버의 <code class=\"language-text\">Socket</code>과 동일하게, <code class=\"language-text\">on</code>으로 특정 이벤트 키에 대한 감지를 하고, <code class=\"language-text\">.emit</code>으로 특정 이벤트 키에 대한 요청을 보낸다.</li>\n<li>\n<p><code class=\"language-text\">const socket = io();</code> 이 부분에서, <code class=\"language-text\">url</code>을 인자로 보내 동일 포트가 아닌 다른 포트로 요청을 보낼 수 도 있는것 같았다.</p>\n<blockquote>\n<p>물론, 서버에서 <code class=\"language-text\">cors</code>와 관련되어 허용 주소로 지정해줘야 함.</p>\n</blockquote>\n</li>\n<li>현재는 바로 <code class=\"language-text\">Socket</code>에 접속하도록 되어있지만, 필요에 따라 사용자가 원할 때 <code class=\"language-text\">connect</code>를 할 수 있도록 할 수 있다고 한다.</li>\n</ul>\n<h2 id=\"-결과\" style=\"position:relative;\"><a href=\"#-%EA%B2%B0%EA%B3%BC\" aria-label=\" 결과 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🌮 결과</h2>\n<h3 id=\"🥧-채팅-참여---퇴장--클라이언트\" style=\"position:relative;\"><a href=\"#%F0%9F%A5%A7-%EC%B1%84%ED%8C%85-%EC%B0%B8%EC%97%AC---%ED%87%B4%EC%9E%A5--%ED%81%B4%EB%9D%BC%EC%9D%B4%EC%96%B8%ED%8A%B8\" aria-label=\"🥧 채팅 참여   퇴장  클라이언트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🥧 채팅 참여 - 퇴장 / 클라이언트</h3>\n<div style=\"margin : 0 auto; text-align : center\">\n  <img src=\"/img/2021/05/07/2.gif\" alt=\"2\">\n</div>\n<ul>\n<li>원래대로라면, 퇴장하였을 때 다시 <code class=\"language-text\">index.html</code>로 돌아가지만, 퇴장했다는 문구가 잘 뜨는지 확인하기 위해 이동하진 않았다.</li>\n</ul>\n<h3 id=\"-채팅-참여---퇴장--서버\" style=\"position:relative;\"><a href=\"#-%EC%B1%84%ED%8C%85-%EC%B0%B8%EC%97%AC---%ED%87%B4%EC%9E%A5--%EC%84%9C%EB%B2%84\" aria-label=\" 채팅 참여   퇴장  서버 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🍷 채팅 참여 - 퇴장 / 서버</h3>\n<div style=\"margin : 0 auto; text-align : center\">\n  <img src=\"/img/2021/05/07/3.gif\" alt=\"3\">\n</div>\n<ul>\n<li>이게 뭔가 싶겠지만, <code class=\"language-text\">room.html</code>로 이동하였을 때, <code class=\"language-text\">Socket Connected</code>가 서버에서 호출되고, 클라이언트에서 나가기를 눌렀을 때, 서버에서 <code class=\"language-text\">Socket Disconnected</code>가 호출된다.</li>\n<li>당연히, <code class=\"language-text\">Socket Disconnected</code>가 호출된 뒤로는 클라이언트에서 무슨 채팅을 처도 아무런 변화가 없다.</li>\n</ul>\n<h2 id=\"🥮-후기\" style=\"position:relative;\"><a href=\"#%F0%9F%A5%AE-%ED%9B%84%EA%B8%B0\" aria-label=\"🥮 후기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🥮 후기</h2>\n<p>정말 재미있는것 같다. 카카오톡이랑 비유를 해본다면</p>\n<ol>\n<li>카카오톡 로그인 - <code class=\"language-text\">Socket Connect</code></li>\n<li>\n<p>대화방 - <code class=\"language-text\">Socket Room</code></p>\n<ul>\n<li>대화방의 이전 대화내용은 <code class=\"language-text\">DB</code>로 저장하고, 해당 방에 입장했을 때 기록을 불러오는 방식</li>\n<li>\n<p>각각의 대화방에 대한 변화(같은 <code class=\"language-text\">id</code>의 대화방을 사용하고있는 사람의 채팅)를 서버에서는 <code class=\"language-text\">.emit</code>으로 보내고, 클라이언트에서는 <code class=\"language-text\">.on</code>으로 감지함</p>\n<blockquote>\n<p>만약 <code class=\"language-text\">React</code>라면, <code class=\"language-text\">.on</code>으로 받아온 횟수를 카운팅하여 누적된 새로운 메시지 갯수 출력?\n가장 최신의 대화만 <code class=\"language-text\">thumbnail</code>로 노출</p>\n</blockquote>\n</li>\n</ul>\n</li>\n<li>카카오톡 로그아웃 - <code class=\"language-text\">Socket disConnect</code></li>\n</ol>\n<p>이런 느낌이지 않을까..?</p>\n<blockquote>\n<p>건방지게 감히 예상을 해보았다.</p>\n</blockquote>\n<h2 id=\"-참고\" style=\"position:relative;\"><a href=\"#-%EC%B0%B8%EA%B3%A0\" aria-label=\" 참고 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🍩 참고</h2>\n<ul>\n<li><a href=\"https://medium.com/@yeon22/term-socket%EC%9D%B4%EB%9E%80-7ca7963617ff\">Socket 이란</a></li>\n<li><a href=\"https://edu.goorm.io/learn/lecture/557/%ED%95%9C-%EB%88%88%EC%97%90-%EB%81%9D%EB%82%B4%EB%8A%94-node-js/lesson/174379/web-socket%EC%9D%B4%EB%9E%80\">Web Socket 이란</a></li>\n<li><a href=\"https://socket.io/\">Soket.io</a></li>\n</ul>","frontmatter":{"title":"Web Socket, Socket.io","date":"May 07, 2021"}}},"pageContext":{"slug":"/Study/CS/socket/","previous":{"fields":{"slug":"/Study/Think/setTimout/"},"frontmatter":{"title":"setTimeout은 무조건 지정된 시간 이후에 실행될까?","category":"Study","draft":false,"tag":"Think"}},"next":null}},"staticQueryHashes":["3128451518","3665928227","479399088","479399088"]}